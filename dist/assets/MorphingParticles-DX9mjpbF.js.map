{"version":3,"file":"MorphingParticles-DX9mjpbF.js","sources":["../../src/components/Hero/MorphingParticles.jsx"],"sourcesContent":["import { useRef, useMemo, useEffect, useState } from \"react\";\r\nimport { useFrame, useThree } from \"@react-three/fiber\";\r\nimport { Canvas } from \"@react-three/fiber\";\r\nimport * as THREE from \"three\";\r\n\r\n// Device detection for performance scaling\r\nconst getIsMobile = () => {\r\n  if (typeof window === 'undefined') return false;\r\n  return window.innerWidth < 768 || /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);\r\n};\r\n\r\n// Reduced particle counts for better performance\r\n// Desktop: 20K (was 40K), Mobile: 5K\r\nconst IS_MOBILE = getIsMobile();\r\nconst MORPH_COUNT = IS_MOBILE ? 5000 : 20000;\r\nconst TOTAL_COUNT = MORPH_COUNT;\r\n\r\n// --- Helper Functions ---\r\n\r\nconst randomPointOnSphere = (r) => {\r\n  const theta = Math.random() * Math.PI * 2;\r\n  const phi = Math.acos(2 * Math.random() - 1);\r\n  return [\r\n    r * Math.sin(phi) * Math.cos(theta),\r\n    r * Math.sin(phi) * Math.sin(theta),\r\n    r * Math.cos(phi),\r\n  ];\r\n};\r\n\r\nconst randomPointOnCylinder = (radius, height, axis = \"y\") => {\r\n  const theta = Math.random() * Math.PI * 2;\r\n  const h = (Math.random() - 0.5) * height;\r\n  if (axis === \"x\")\r\n    return [h, radius * Math.cos(theta), radius * Math.sin(theta)];\r\n  if (axis === \"z\")\r\n    return [radius * Math.cos(theta), radius * Math.sin(theta), h];\r\n  return [radius * Math.cos(theta), h, radius * Math.sin(theta)];\r\n};\r\n\r\nconst randomPointInBoxShell = (x, y, z, thickness = 0.1) => {\r\n  const axis = Math.floor(Math.random() * 3);\r\n  const sign = Math.random() > 0.5 ? 1 : -1;\r\n  let px = (Math.random() - 0.5) * x;\r\n  let py = (Math.random() - 0.5) * y;\r\n  let pz = (Math.random() - 0.5) * z;\r\n  if (axis === 0) px = (x / 2) * sign;\r\n  if (axis === 1) py = (y / 2) * sign;\r\n  if (axis === 2) pz = (z / 2) * sign;\r\n  return [\r\n    px + (Math.random() - 0.5) * thickness,\r\n    py + (Math.random() - 0.5) * thickness,\r\n    pz + (Math.random() - 0.5) * thickness,\r\n  ];\r\n};\r\n\r\nconst rotateX = (x, y, z, angle) => {\r\n  const cos = Math.cos(angle);\r\n  const sin = Math.sin(angle);\r\n  return [x, y * cos - z * sin, y * sin + z * cos];\r\n};\r\n\r\nconst rotateY = (x, y, z, angle) => {\r\n  const cos = Math.cos(angle);\r\n  const sin = Math.sin(angle);\r\n  return [x * cos + z * sin, y, -x * sin + z * cos];\r\n};\r\n\r\nconst rotateZ = (x, y, z, angle) => {\r\n  const cos = Math.cos(angle);\r\n  const sin = Math.sin(angle);\r\n  return [x * cos - y * sin, x * sin + y * cos, z];\r\n};\r\n\r\n// --- Shape Generators ---\r\n\r\n// DRONE - MASSIVE SCALE\r\nconst PROP_START_INDEX = Math.floor(MORPH_COUNT * 0.5);\r\nconst PROP_COUNT = Math.floor((MORPH_COUNT - PROP_START_INDEX) / 4);\r\n\r\nconst generateDroneStaticParts = () => {\r\n  const points = [];\r\n  const tiltAngle = -Math.PI / 8;\r\n\r\n  const addPoint = (x, y, z) => {\r\n    const p = rotateX(x, y, z, tiltAngle);\r\n    points.push(...p);\r\n  };\r\n\r\n  // Body (Upscaled x1.3)\r\n  const bodyPoints = Math.floor(PROP_START_INDEX * 0.4);\r\n  for (let i = 0; i < bodyPoints; i++) {\r\n    const p = randomPointInBoxShell(3.0, 1.0, 5.5, 0.1); // Standard Scale\r\n    if (Math.abs(p[2]) > 2.6) {\r\n      p[0] *= 0.8;\r\n      p[1] *= 0.7;\r\n    }\r\n    addPoint(p[0], p[1], p[2]);\r\n  }\r\n\r\n  // ... rest of drone scaled similarly ...\r\n  // For brevity, using simplified scaling logic inline or assume logic handles it\r\n  // Re-generating full drone logic with scale 1.3\r\n  const scale = 1.3;\r\n\r\n  // Gimbal\r\n  // Gimbal REMOVED\r\n  // const camPoints = ...\r\n  // Arms\r\n  const armLen = 4.2; \r\n  const armCount = Math.floor((PROP_START_INDEX - bodyPoints) / 4); // Adjusted count\r\n  const armOffsets = [\r\n    [1, 1],\r\n    [-1, 1],\r\n    [1, -1],\r\n    [-1, -1],\r\n  ];\r\n  for (let k = 0; k < 4; k++) {\r\n    const dirX = armOffsets[k][0];\r\n    const dirZ = armOffsets[k][1];\r\n    const startX = 1.0 * dirX;\r\n    const startZ = 1.2 * dirZ;\r\n    const endX = 4.2 * dirX;\r\n    const endZ = 4.2 * dirZ;\r\n    for (let i = 0; i < armCount * 0.6; i++) {\r\n      const t = Math.random();\r\n      addPoint(\r\n        startX + (endX - startX) * t + (Math.random() - 0.5) * 0.3,\r\n        (Math.random() - 0.5) * 0.3,\r\n        startZ + (endZ - startZ) * t + (Math.random() - 0.5) * 0.3,\r\n      );\r\n    }\r\n    for (let i = 0; i < armCount * 0.2; i++) {\r\n      const p = randomPointOnCylinder(0.9, 1.0, \"y\");\r\n      addPoint(endX + p[0], p[1] + 0.4, endZ + p[2]);\r\n    }\r\n    for (let i = 0; i < armCount * 0.2; i++) {\r\n      const p = randomPointOnCylinder(0.3, 2.0, \"y\");\r\n      addPoint(endX + p[0], -1.0 + p[1], endZ + p[2]);\r\n    }\r\n  }\r\n  while (points.length < PROP_START_INDEX * 3) points.push(0, 0, 0);\r\n  return new Float32Array(points);\r\n};\r\n\r\n// ROVER - CURIOSITY STYLE (Detailed & Solid)\r\nconst generateRover = () => {\r\n  const points = [];\r\n  const rotAngle = Math.PI / 6;\r\n  const tiltX = 0.1;\r\n  const scale = 1.6;\r\n  const offsetY = -2.5;\r\n\r\n  const addPoint = (x, y, z) => {\r\n    let sx = x * scale;\r\n    let sy = y * scale;\r\n    let sz = z * scale;\r\n    let p = rotateY(sx, sy, sz, rotAngle);\r\n    p = rotateX(p[0], p[1], p[2], tiltX);\r\n    points.push(p[0], p[1] + offsetY, p[2]);\r\n  };\r\n\r\n  const chassisCount = Math.floor(MORPH_COUNT * 0.25);\r\n  for (let i = 0; i < chassisCount; i++) {\r\n    const p = randomPointInBoxShell(2.2, 0.6, 3.5, 0.1);\r\n    addPoint(p[0], p[1] + 0.5, p[2]);\r\n  }\r\n  const rtgCount = Math.floor(MORPH_COUNT * 0.05);\r\n  for (let i = 0; i < rtgCount; i++) {\r\n    const p = randomPointOnCylinder(0.4, 1.2, \"y\");\r\n    const tilted = rotateX(p[0], p[1], p[2], -Math.PI / 4);\r\n    addPoint(tilted[0], tilted[1] + 1.0, tilted[2] + 1.8);\r\n  }\r\n  const mastCount = Math.floor(MORPH_COUNT * 0.1);\r\n  for (let i = 0; i < mastCount; i++) {\r\n    if (i < mastCount * 0.7) {\r\n      const h = Math.random() * 2.2;\r\n      addPoint(\r\n        0.8 + (Math.random() - 0.5) * 0.15,\r\n        1.0 + h,\r\n        -1.2 + (Math.random() - 0.5) * 0.15,\r\n      );\r\n    } else {\r\n      const p = randomPointInBoxShell(0.8, 0.5, 0.6);\r\n      addPoint(0.8 + p[0], 3.3 + p[1], -1.2 + p[2]);\r\n    }\r\n  }\r\n  // Arm Removed\r\n  const armCount = 0;\r\n\r\n  const remaining =\r\n    MORPH_COUNT - chassisCount - rtgCount - mastCount - armCount;\r\n  const wheelPositions = [\r\n    [-1.8, -1.2, -1.6],\r\n    [-1.8, -1.2, 0.2],\r\n    [-1.8, -1.2, 2.0],\r\n    [1.8, -1.2, -1.6],\r\n    [1.8, -1.2, 0.2],\r\n    [1.8, -1.2, 2.0],\r\n  ];\r\n  const pPerWheel = Math.floor((remaining * 0.8) / 6);\r\n  let pForStruts = remaining - pPerWheel * 6;\r\n\r\n  for (let wp of wheelPositions) {\r\n    for (let j = 0; j < pPerWheel; j++) {\r\n      const type = Math.random();\r\n      let px = 0,\r\n        py = 0,\r\n        pz = 0;\r\n      const radius = 0.9;\r\n      const width = 0.8;\r\n      if (type < 0.6) {\r\n        const theta = Math.random() * Math.PI * 2;\r\n        px = (Math.random() - 0.5) * width;\r\n        py = radius * Math.cos(theta);\r\n        pz = radius * Math.sin(theta);\r\n      } else {\r\n        const r = Math.sqrt(Math.random()) * radius;\r\n        const theta = Math.random() * Math.PI * 2;\r\n        const side = Math.random() > 0.5 ? 1 : -1;\r\n        px = (width / 2) * side;\r\n        py = r * Math.cos(theta);\r\n        pz = r * Math.sin(theta);\r\n      }\r\n      addPoint(wp[0] + px, wp[1] + py, wp[2] + pz);\r\n    }\r\n  }\r\n\r\n  // Helper for thick lines\r\n  const addThickStrut = (p1, p2, count) => {\r\n    for (let k = 0; k < count; k++) {\r\n      const t = Math.random();\r\n      const r = 0.15;\r\n      addPoint(\r\n        p1[0] + (p2[0] - p1[0]) * t + (Math.random() - 0.5) * r,\r\n        p1[1] + (p2[1] - p1[1]) * t + (Math.random() - 0.5) * r,\r\n        p1[2] + (p2[2] - p1[2]) * t + (Math.random() - 0.5) * r,\r\n      );\r\n    }\r\n  };\r\n  const strutPointsPerLeg = Math.floor(pForStruts / 6);\r\n  for (let i = 0; i < 6; i++) {\r\n    const wp = wheelPositions[i];\r\n    const side = wp[0] > 0 ? 1 : -1;\r\n    const cp = [1.1 * side, 0.5, wp[2]];\r\n    const knee = [wp[0], wp[1] + 1.2, wp[2]];\r\n    addThickStrut(wp, knee, strutPointsPerLeg * 0.5);\r\n    addThickStrut(knee, cp, strutPointsPerLeg * 0.5);\r\n  }\r\n  while (points.length < MORPH_COUNT * 3) points.push(0, 0, 0);\r\n  return new Float32Array(points);\r\n};\r\n\r\n// PLANE - VINTAGE BIPLANE (Solid, 3-Wheels, 3D Tilted, Connected Tail)\r\n// Range for Propeller Points\r\nconst PLANE_PROP_OFFSET = Math.floor(MORPH_COUNT * 0.85);\r\nconst PLANE_PROP_COUNT = MORPH_COUNT - PLANE_PROP_OFFSET;\r\n\r\nconst generatePlane = () => {\r\n  const points = [];\r\n  const scale = 1.75; // MASSIVE SCALE\r\n  const tiltX = 0.2;\r\n  const tiltY = -0.6;\r\n  const tiltZ = 0.2;\r\n  const offsetY = 0.5; // Lower it a bit as it's huge\r\n\r\n  // Helper: 3D Rotate\r\n  const transform = (x, y, z) => {\r\n    let px = x * scale;\r\n    let py = y * scale;\r\n    let pz = z * scale;\r\n    let p = rotateY(px, py, pz, tiltY);\r\n    p = rotateX(p[0], p[1], p[2], tiltX);\r\n    p = rotateZ(p[0], p[1], p[2], tiltZ);\r\n    return [p[0], p[1] + offsetY, p[2]];\r\n  };\r\n\r\n  const addPoint = (x, y, z) => {\r\n    const p = transform(x, y, z);\r\n    points.push(p[0], p[1], p[2]);\r\n  };\r\n\r\n  // Helper: Solid Box\r\n  const addBox = (w, h, d, count, cx = 0, cy = 0, cz = 0) => {\r\n    for (let i = 0; i < count; i++) {\r\n      addPoint(\r\n        cx + (Math.random() - 0.5) * w,\r\n        cy + (Math.random() - 0.5) * h,\r\n        cz + (Math.random() - 0.5) * d,\r\n      );\r\n    }\r\n  };\r\n\r\n  // Helper: Solid Cylinder\r\n  const addCyl = (r, len, count, cx = 0, cy = 0, cz = 0, axis = \"z\") => {\r\n    for (let i = 0; i < count; i++) {\r\n      const p = randomPointOnCylinder(r * Math.sqrt(Math.random()), len, axis);\r\n      addPoint(cx + p[0], cy + p[1], cz + p[2]);\r\n    }\r\n  };\r\n\r\n  // 1. FUSELAGE (Extended to connect Tail)\r\n  const fusePoints = Math.floor(MORPH_COUNT * 0.35); // More points\r\n  for (let i = 0; i < fusePoints; i++) {\r\n    // Z Range: -2.0 (Nose) to 4.0 (Tail) -> Length 6.0\r\n    const z = -2.0 + Math.random() * 6.0;\r\n\r\n    // Radius Function\r\n    let r = 0.8;\r\n    if (z < -1.0) r *= 1.0 - (-z - 1.0) / 1.5; // Nose rounded\r\n    if (z > 1.0) r *= 1.0 - (z - 1.0) / 4.0; // Slow taper to tail\r\n\r\n    // Ensure minimum thickness at tail to connect\r\n    if (z > 3.0) r = Math.max(r, 0.25);\r\n\r\n    const rad = r * Math.sqrt(Math.random());\r\n    const ang = Math.random() * 6.28;\r\n    // Cockpit\r\n    if (z > -0.5 && z < 0.5 && rad * Math.sin(ang) > 0.4) continue;\r\n    addPoint(rad * Math.cos(ang), rad * Math.sin(ang), z);\r\n  }\r\n\r\n  // 2. WINGS\r\n  const wingPoints = Math.floor(MORPH_COUNT * 0.35);\r\n  const upperCount = Math.floor(wingPoints / 2);\r\n  addBox(7.0, 0.15, 1.4, wingPoints - upperCount, 0, -0.2, 0.5);\r\n  addBox(7.2, 0.15, 1.4, upperCount, 0, 1.3, 0.3);\r\n\r\n  // 3. STRUTS & GEAR\r\n  const miscPoints = Math.floor(MORPH_COUNT * 0.15);\r\n\r\n  // Struts\r\n  const postCount = Math.floor(miscPoints * 0.2);\r\n  addBox(0.15, 1.5, 0.15, Math.floor(postCount / 4), 2.5, 0.55, 0.5);\r\n  addBox(0.15, 1.5, 0.15, Math.floor(postCount / 4), -2.5, 0.55, 0.5);\r\n  addBox(0.15, 1.5, 0.15, Math.floor(postCount / 4), 1.0, 0.55, 0.3);\r\n  addBox(0.15, 1.5, 0.15, Math.floor(postCount / 4), -1.0, 0.55, 0.3);\r\n\r\n  // Gear (Thicker)\r\n  const gearPoints = miscPoints - postCount;\r\n  const wheelPoints = Math.floor(gearPoints * 0.4);\r\n  const legPoints = gearPoints - wheelPoints;\r\n  const legCount = Math.floor(legPoints / 2);\r\n\r\n  // Legs\r\n  addCyl(0.12, 1.2, legCount, 0.8, -1.0, 0.8, \"y\");\r\n  addCyl(0.12, 1.2, legCount, -0.8, -1.0, 0.8, \"y\");\r\n\r\n  // Wheels (3 Wheels)\r\n  const wp = Math.floor(wheelPoints / 3);\r\n  addCyl(0.35, 0.25, wp, 0.8, -1.6, 0.8, \"x\");\r\n  addCyl(0.35, 0.25, wp, -0.8, -1.6, 0.8, \"x\");\r\n  addCyl(0.2, 0.15, wp, 0, -0.6, 3.8, \"x\"); // Tail Wheel attached at Z=3.8\r\n\r\n  // 4. TAIL (Connected at Z=3.8)\r\n  const tailPoints = Math.floor(MORPH_COUNT * 0.1);\r\n  // Horizontal Stabilizer\r\n  addBox(2.8, 0.12, 1.4, Math.floor(tailPoints * 0.6), 0, 0.2, 3.9);\r\n  // Vertical Stabilizer (Taller and thicker)\r\n  addBox(0.2, 2.0, 1.4, Math.floor(tailPoints * 0.4), 0, 1.2, 3.9);\r\n\r\n  // 5. PROPELLER PLACEHOLDERS\r\n  for (let i = 0; i < PLANE_PROP_COUNT; i++) {\r\n    addPoint(0, 0, 0);\r\n  }\r\n\r\n  while (points.length < MORPH_COUNT * 3) points.push(0, 0, 0);\r\n  return new Float32Array(points.slice(0, MORPH_COUNT * 3));\r\n};\r\n\r\n// --- Texture Helper ---\r\nconst getCircleTexture = () => {\r\n  if (typeof document === \"undefined\") return null; // SSR Safety\r\n  const canvas = document.createElement(\"canvas\");\r\n  canvas.width = 32;\r\n  canvas.height = 32;\r\n  const ctx = canvas.getContext(\"2d\");\r\n  ctx.beginPath();\r\n  ctx.arc(16, 16, 14, 0, 2 * Math.PI);\r\n  ctx.fillStyle = \"#ffffff\";\r\n  ctx.fill();\r\n  const texture = new THREE.CanvasTexture(canvas);\r\n  return texture;\r\n};\r\n\r\nconst MorphingScene = () => {\r\n  const meshRef = useRef();\r\n  const { clock, mouse, viewport } = useThree(); // Get viewport\r\n  const circleTex = useMemo(() => getCircleTexture(), []);\r\n\r\n  // ... (keep static generation memoization)\r\n  const droneStatic = useMemo(() => generateDroneStaticParts(), []);\r\n  const [geo2] = useState(generateRover());\r\n  const planeStatic = useMemo(() => generatePlane(), []);\r\n\r\n  // ... (keep props offsets memoization)\r\n  const propOffsets = useMemo(() => {\r\n    const offsets = new Float32Array(PROP_COUNT * 4 * 3);\r\n    for (let k = 0; k < 4; k++) {\r\n      for (let i = 0; i < PROP_COUNT; i++) {\r\n        const r = Math.random() * 3.0;\r\n        const blade = Math.random() > 0.5 ? 0 : Math.PI;\r\n        const idx = (k * PROP_COUNT + i) * 3;\r\n        offsets[idx] = r;\r\n        offsets[idx + 1] = blade + (Math.random() - 0.5) * 0.15;\r\n        offsets[idx + 2] = (Math.random() - 0.5) * 0.1;\r\n      }\r\n    }\r\n    return offsets;\r\n  }, []);\r\n\r\n  const planePropOffsets = useMemo(() => {\r\n    const arr = new Float32Array(PLANE_PROP_COUNT * 3);\r\n    for (let i = 0; i < PLANE_PROP_COUNT; i++) {\r\n      arr[i * 3] = Math.random() * 2.0; // Radius\r\n      arr[i * 3 + 1] = Math.random() > 0.5 ? 0 : Math.PI; // Blade\r\n      arr[i * 3 + 2] = (Math.random() - 0.5) * 0.3; // Width jitter\r\n    }\r\n    return arr;\r\n  }, []);\r\n\r\n  const currentPositions = useMemo(() => new Float32Array(TOTAL_COUNT * 3), []);\r\n  const droneCurrent = useMemo(() => new Float32Array(MORPH_COUNT * 3), []);\r\n  const planeCurrent = useMemo(() => new Float32Array(MORPH_COUNT * 3), []);\r\n\r\n  useEffect(() => {\r\n    droneCurrent.set(droneStatic, 0);\r\n    planeCurrent.set(planeStatic, 0);\r\n  }, [droneStatic, droneCurrent, planeStatic, planeCurrent, currentPositions]);\r\n\r\n  useFrame((state) => {\r\n    // Skip updates when tab is hidden for performance\r\n    if (document.hidden) return;\r\n    \r\n    const time = clock.getElapsedTime();\r\n    const maxScroll = Math.max(document.documentElement.scrollHeight - window.innerHeight, 0);\r\n    let scrollPct = 0;\r\n    if (maxScroll > 10) {\r\n        scrollPct = Math.min(Math.max(window.scrollY / maxScroll, 0), 1);\r\n    }\r\n\r\n    // ... (Animation Loops - No Change Needed here)\r\n    // DRONE Prop Animation\r\n    if (scrollPct < 0.6) {\r\n      const tiltAngle = -Math.PI / 8;\r\n      const armOffsets = [\r\n        [4.2, 4.2],\r\n        [-4.2, 4.2],\r\n        [4.2, -4.2],\r\n        [-4.2, -4.2],\r\n      ];\r\n      const propSpeed = 20.0;\r\n      for (let k = 0; k < 4; k++) {\r\n        const cx = armOffsets[k][0];\r\n        const cz = armOffsets[k][1];\r\n        for (let i = 0; i < PROP_COUNT; i++) {\r\n          const offIdx = (k * PROP_COUNT + i) * 3;\r\n          const r = propOffsets[offIdx];\r\n          const angleBase = propOffsets[offIdx + 1];\r\n          const j = propOffsets[offIdx + 2];\r\n          const theta = angleBase + time * propSpeed;\r\n          const lx = r * Math.cos(theta);\r\n          const lz = r * Math.sin(theta);\r\n          const ly = 0.8 + j;\r\n          const p = rotateX(cx + lx, ly, cz + lz, tiltAngle);\r\n          const ptIdx = (PROP_START_INDEX + k * PROP_COUNT + i) * 3;\r\n          droneCurrent[ptIdx] = p[0];\r\n          droneCurrent[ptIdx + 1] = p[1];\r\n          droneCurrent[ptIdx + 2] = p[2];\r\n        }\r\n      }\r\n    }\r\n\r\n    // PLANE Prop Animation (Structured Blades)\r\n    if (scrollPct > 0.4) {\r\n      const scale = 1.75;\r\n      const offsetY = 0.5;\r\n      const tiltX = 0.2;\r\n      const tiltY = -0.6;\r\n      const tiltZ = 0.2;\r\n      const propSpeed = 15.0;\r\n      const bladePoints = Math.max(1, Math.floor(PLANE_PROP_COUNT / 2));\r\n\r\n      for (let i = 0; i < PLANE_PROP_COUNT; i++) {\r\n        // Determine which blade (0 or 1)\r\n        const blade = i < bladePoints ? 0 : 1;\r\n        const bladeOffset = blade * Math.PI;\r\n\r\n        // Generate Blade Shape (Oval) dynamically\r\n        const t = (i % bladePoints) / bladePoints;\r\n        // Radius 0..2.2\r\n        const r = t * 2.2;\r\n        // Width taper (thick in middle, thin at tip/root)\r\n        const width = 0.3 * Math.sin(t * Math.PI);\r\n\r\n        // Rotate by Time\r\n        const theta = bladeOffset + time * propSpeed;\r\n\r\n        // Local Coords (Blade is flat on XY, at Z=-2.1)\r\n        // Add width jitter\r\n        const wOffset = (Math.random() - 0.5) * width;\r\n\r\n        // Spin\r\n        let px = r * Math.cos(theta) - wOffset * Math.sin(theta);\r\n        let py = r * Math.sin(theta) + wOffset * Math.cos(theta);\r\n        let pz = -2.1 + (Math.random() - 0.5) * 0.05; // Thin prop\r\n\r\n        // Transform\r\n        let psx = px * scale;\r\n        let psy = py * scale;\r\n        let psz = pz * scale;\r\n        let p = rotateY(psx, psy, psz, tiltY);\r\n        p = rotateX(p[0], p[1], p[2], tiltX);\r\n        p = rotateZ(p[0], p[1], p[2], tiltZ);\r\n\r\n        const idx = (PLANE_PROP_OFFSET + i) * 3;\r\n        planeCurrent[idx] = p[0];\r\n        planeCurrent[idx + 1] = p[1] + offsetY;\r\n        planeCurrent[idx + 2] = p[2];\r\n      }\r\n    }\r\n\r\n    // Morphing\r\n    if (scrollPct < 0.5) {\r\n      const t = Math.min(scrollPct * 2, 1);\r\n      for (let i = 0; i < MORPH_COUNT * 3; i++) {\r\n        currentPositions[i] +=\r\n          (droneCurrent[i] * (1 - t) + geo2[i] * t - currentPositions[i]) *\r\n          0.15;\r\n      }\r\n    } else {\r\n      // Finish morph by 0.8\r\n      const t = Math.min((scrollPct - 0.5) * 3.5, 1);\r\n      for (let i = 0; i < MORPH_COUNT * 3; i++) {\r\n        // Blend to planeCurrent (Dynamic)\r\n        currentPositions[i] +=\r\n          (geo2[i] * (1 - t) + planeCurrent[i] * t - currentPositions[i]) *\r\n          0.15;\r\n      }\r\n    }\r\n\r\n    if (meshRef.current) {\r\n      meshRef.current.geometry.attributes.position.needsUpdate = true;\r\n      meshRef.current.rotation.y = time * 0.1 + state.mouse.x * 0.2;\r\n      meshRef.current.rotation.x = 0.1 + state.mouse.y * 0.1;\r\n\r\n      // --- SMOOTH TRAVEL ANIMATION (RESPONSIVE) ---\r\n      const isMobile = viewport.width < 15;\r\n      // Mobile: Straight and Middle (0 Travel)\r\n      // Desktop: Wide Travel (10 Travel)\r\n      const maxTravel = isMobile ? 0 : 10;\r\n\r\n      // 0.0 - 0.20: Right (+Travel)\r\n      // 0.35 - 0.60: Left (-Travel)\r\n      // 0.80 - 1.00: Right (+Travel)\r\n\r\n      const getKeyframeX = (s) => {\r\n        if (s < 0.2) return maxTravel;\r\n        if (s < 0.35) {\r\n          // Transit R -> L\r\n          const t = (s - 0.2) / 0.15;\r\n          return maxTravel * (1 - t) + -maxTravel * t;\r\n        }\r\n        if (s < 0.6) return -maxTravel;\r\n        if (s < 0.8) {\r\n          // Transit L -> R\r\n          const t = (s - 0.6) / 0.2;\r\n          return -maxTravel * (1 - t) + maxTravel * t;\r\n        }\r\n        return maxTravel;\r\n      };\r\n\r\n      const targetX = getKeyframeX(scrollPct);\r\n\r\n      // Interpolate (Damping)\r\n      meshRef.current.position.x +=\r\n        (targetX - meshRef.current.position.x) * 0.08;\r\n\r\n      // Responsive Scale\r\n      // Default 1.0, Mobile 0.6\r\n      const targetScale = isMobile ? 0.6 : 1.0;\r\n      // Smooth scale transition not strictly needed but good for resize\r\n      meshRef.current.scale.setScalar(targetScale);\r\n    }\r\n  });\r\n\r\n  return (\r\n    <points ref={meshRef} position={[10, 0, 0]}>\r\n      <bufferGeometry>\r\n        <bufferAttribute\r\n          attach=\"attributes-position\"\r\n          count={TOTAL_COUNT}\r\n          array={currentPositions}\r\n          itemSize={3}\r\n        />\r\n      </bufferGeometry>\r\n      <pointsMaterial\r\n        size={0.12} // Slightly larger for circles\r\n        color=\"#00e5ff\"\r\n        map={circleTex} // Round Texture\r\n        alphaTest={0.5}\r\n        transparent\r\n        opacity={0.8}\r\n        sizeAttenuation\r\n        blending={THREE.AdditiveBlending}\r\n        depthWrite={false}\r\n      />\r\n    </points>\r\n  );\r\n};\r\n\r\n// Animated 'Pretty' Starfield - reduced count for performance\r\nconst StarField = () => {\r\n  const mesh = useRef();\r\n  const circleTex = useMemo(() => getCircleTexture(), []);\r\n  // Reduced star count: 1500 desktop, 500 mobile (was 4000)\r\n  const count = IS_MOBILE ? 500 : 1500;\r\n\r\n  // Generate Positions and Colors\r\n  const [positions, colors] = useMemo(() => {\r\n    const pos = new Float32Array(count * 3);\r\n    const col = new Float32Array(count * 3);\r\n    const colorPalette = [\r\n      new THREE.Color(\"#ffffff\"), // White\r\n      new THREE.Color(\"#00e5ff\"), // Cyan\r\n      new THREE.Color(\"#0066ff\"), // Blue\r\n      new THREE.Color(\"#88ccff\"), // Pale Blue\r\n    ];\r\n\r\n    for (let i = 0; i < count; i++) {\r\n      // Position\r\n      const r = 10 + Math.random() * 100; // Keep away from center\r\n      const theta = Math.random() * Math.PI * 2;\r\n      const phi = Math.acos(2 * Math.random() - 1);\r\n      pos[i * 3] = r * Math.sin(phi) * Math.cos(theta);\r\n      pos[i * 3 + 1] = r * Math.sin(phi) * Math.sin(theta);\r\n      pos[i * 3 + 2] = r * Math.cos(phi);\r\n\r\n      // Color\r\n      const c = colorPalette[Math.floor(Math.random() * colorPalette.length)];\r\n      col[i * 3] = c.r;\r\n      col[i * 3 + 1] = c.g;\r\n      col[i * 3 + 2] = c.b;\r\n    }\r\n    return [pos, col];\r\n  }, []);\r\n\r\n  useFrame((state, delta) => {\r\n    // Skip when tab is hidden\r\n    if (document.hidden) return;\r\n    if (mesh.current) {\r\n      mesh.current.rotation.y -= delta * 0.05;\r\n      mesh.current.rotation.x += delta * 0.01;\r\n    }\r\n  });\r\n\r\n  return (\r\n    <points ref={mesh}>\r\n      <bufferGeometry>\r\n        <bufferAttribute\r\n          attach=\"attributes-position\"\r\n          count={count}\r\n          array={positions}\r\n          itemSize={3}\r\n        />\r\n        <bufferAttribute\r\n          attach=\"attributes-color\"\r\n          count={count}\r\n          array={colors}\r\n          itemSize={3}\r\n        />\r\n      </bufferGeometry>\r\n      <pointsMaterial\r\n        size={0.25}\r\n        vertexColors\r\n        map={circleTex}\r\n        alphaTest={0.5}\r\n        transparent\r\n        opacity={0.6}\r\n        sizeAttenuation\r\n        depthWrite={false}\r\n        blending={THREE.AdditiveBlending}\r\n      />\r\n    </points>\r\n  );\r\n};\r\n\r\nconst MorphingParticles = () => {\r\n  return (\r\n    <div\r\n      style={{\r\n        position: \"fixed\",\r\n        top: 0,\r\n        left: 0,\r\n        width: \"100%\",\r\n        height: \"100vh\",\r\n        zIndex: -1,\r\n        pointerEvents: \"none\",\r\n        background: \"#0a0a14\",\r\n      }}\r\n    >\r\n      <Canvas\r\n        camera={{ position: [0, 0, 22], fov: 50 }}\r\n        gl={{ \r\n          antialias: false,  // Disable for better performance\r\n          alpha: true,\r\n          powerPreference: \"high-performance\"\r\n        }}\r\n        dpr={Math.min(window.devicePixelRatio, 1.5)}  // Cap pixel ratio\r\n      >\r\n        <color attach=\"background\" args={[\"#0a0a14\"]} />\r\n        <MorphingScene />\r\n        <StarField />\r\n      </Canvas>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MorphingParticles;\r\n"],"names":["IS_MOBILE","window","innerWidth","test","navigator","userAgent","MORPH_COUNT","TOTAL_COUNT","randomPointOnCylinder","radius","height","axis","theta","Math","random","PI","h","cos","sin","randomPointInBoxShell","x","y","z","thickness","floor","sign","px","py","pz","rotateX","angle","rotateY","rotateZ","PROP_START_INDEX","PROP_COUNT","PLANE_PROP_OFFSET","PLANE_PROP_COUNT","generatePlane","points","scale","addPoint","p","transform","push","addBox","w","d","count","cx","cy","cz","i","addCyl","r","len","sqrt","fusePoints","max","rad","ang","wingPoints","upperCount","miscPoints","postCount","gearPoints","wheelPoints","legPoints","legCount","wp","tailPoints","length","Float32Array","slice","getCircleTexture","document","canvas","createElement","width","ctx","getContext","beginPath","arc","fillStyle","fill","THREE.CanvasTexture","MorphingScene","meshRef","useRef","clock","mouse","viewport","useThree","circleTex","useMemo","droneStatic","tiltAngle","bodyPoints","abs","armCount","armOffsets","k","dirX","dirZ","startX","startZ","endX","endZ","t","generateDroneStaticParts","geo2","useState","rotAngle","chassisCount","rtgCount","tilted","mastCount","remaining","wheelPositions","pPerWheel","pForStruts","j","addThickStrut","p1","p2","strutPointsPerLeg","cp","knee","generateRover","planeStatic","propOffsets","offsets","blade","idx","arr","currentPositions","droneCurrent","planeCurrent","useEffect","set","useFrame","state","hidden","time","getElapsedTime","maxScroll","documentElement","scrollHeight","innerHeight","scrollPct","min","scrollY","propSpeed","offIdx","angleBase","lx","lz","ptIdx","offsetY","tiltX","tiltY","tiltZ","bladePoints","bladeOffset","wOffset","current","geometry","attributes","position","needsUpdate","rotation","isMobile","maxTravel","targetX","s","getKeyframeX","targetScale","setScalar","jsxs","ref","children","jsx","attach","array","itemSize","size","color","map","alphaTest","transparent","opacity","sizeAttenuation","blending","THREE.AdditiveBlending","depthWrite","StarField","mesh","positions","colors","pos","col","colorPalette","THREE.Color","phi","acos","c","g","b","delta","vertexColors","MorphingParticles","style","top","left","zIndex","pointerEvents","background","Canvas","camera","fov","gl","antialias","alpha","powerPreference","dpr","devicePixelRatio","args"],"mappings":"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"}